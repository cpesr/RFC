---
title: "Concours MCF"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(ggthemes)
library(ggbeeswarm)
library("gridExtra")
require("ggrepel")
library(ggcpesrthemes)
library(ggpmisc)
library(robCompositions)
cnu <- read.table("DB_CNU_QualificationRecrutements_20201123.csv", h=T, sep=";") %>%
  mutate(SectionCNU.ID = as.factor(SectionCNU.ID),
         candidatures.par.candidat.MCF = Candidatures.MCF / Candidats.MCF,
         candidatures.par.poste.MCF = Candidatures.MCF / PostesPublies.MCF,
         candidats.par.poste.MCF = Candidats.MCF / PostesPublies.MCF,
         candidatures.par.candidat.par.poste.MCF = candidatures.par.candidat.MCF / PostesPublies.MCF,
         GrandeDisciplineCNU = as.factor(GrandeDisciplineCNU),
         Code.GrandeDisciplineCNU = recode(GrandeDisciplineCNU, 
                                           "Droit éco ges" ="DEG",
                                           "Lettres et sciences humaines" = "LSHS",
                                           "Pharmacie" = "Pharma",
                                           "Sciences et techniques" = "ST")
         )

my.formula <- y ~ x

# D'après http://www.sthda.com/english/wiki/ggplot2-barplots-quick-start-guide-r-software-and-data-visualization
#+++++++++++++++++++++++++
# Function to calculate the mean and the standard deviation
  # for each group
#+++++++++++++++++++++++++
# data : a data frame
# varname : the name of a column containing the variable
  #to be summariezed
# groupnames : vector of column names to be used as
  # grouping variables
data_summary <- function(data, varname, groupnames){
  require(plyr); require(dplyr)
  summary_func <- function(x, col){
    c(mean = mean(x[[col]], na.rm=TRUE),
      sd = sd(x[[col]], na.rm=TRUE))
  }
  data_sum<-ddply(data, groupnames, .fun=summary_func,
                  varname)
  data_sum <- rename(data_sum, c("mean" = paste(varname, ".mean", sep=""), "sd" = paste(varname, ".sd", sep="")))
 return(data_sum)
}

data_mean <- function(data, varname, groupnames){
  require(plyr); require(dplyr)
  summary_func <- function(x, col){
    c(mean = mean(x[[col]], na.rm=TRUE))
  }
  data_sum<-ddply(data, groupnames, .fun=summary_func,
                  varname)
  data_sum <- rename(data_sum, c("mean" = varname, ".mean", sep=""))
 return(data_sum)
}

data_sd <- function(data, varname, groupnames){
  require(plyr); require(dplyr)
  summary_func <- function(x, col){
    c(sd = sd(x[[col]], na.rm=TRUE))
  }
  data_sum<-ddply(data, groupnames, .fun=summary_func,
                  varname)
  data_sum <- rename(data_sum, c("sd" = varname))
 return(data_sum)
}
```

_Ce document est un brouillon de différentes visualisations. Il a seulement vocation à permettre la discussion. Les observations et propositions peuvent être ajoutées [en issues](https://github.com/cpesr/RFC/issues)._


## Description des données 

- Source : https://www.enseignementsup-recherche.gouv.fr/cid118435/personnels-enseignants-du-superieur-bilans-et-statistiques.html
- Nombre d'observations : `r nrow(cnu)`
- Variables : 
```{r vars}
colnames(cnu)
```
- Période : `r range(as.character(cnu$Annee))`

## Nombre de candidats par poste MCF

### Moyenne toutes sections confondues de 2013 à 2019
```{r MoyenneReussiteQualificationMCF}
tapply(cnu$candidats.par.poste.MCF, cnu$TypeRecrutement, mean, na.rm=T)
tapply(cnu$candidats.par.poste.MCF, cnu$GrandeDisciplineCNU, mean, na.rm=T)
```

### Vision globale par grande discipline et groupes CNU
```{r candidats.par.poste.MCF.1, fig.width=12, fig.asp=9/16}
cnu %>%
  drop_na(candidats.par.poste.MCF) %>%
    ggplot(aes(x=candidats.par.poste.MCF, y=SousGroupeCNU, color=Annee)) +
    geom_jitter(width = 0, height = 0.15) +
    #geom_vline(xintercept=mean(subset(cnu, cnu$Annee==2013)$candidats.par.poste.MCF, na.rm=T), linetype="dashed", color = "#E69F00", size=0.8) + 
    #geom_vline(xintercept=mean(subset(cnu, cnu$Annee==2019)$candidats.par.poste.MCF, na.rm=T), linetype="dashed", color = "#009E73", size=0.8) +
    scale_x_continuous(breaks=seq(0,60,5)) +
    #stat_summary(fun.y=mean, geom="point", shape=4, size=3, color="black") +
    facet_grid(GrandeDisciplineCNU~., scales="free", space="free") +
    theme_cpesr_cap(authors=c("Florent Figon"), licence="CC BY-SA") +
    theme(strip.text.y = element_text(size = 7.5)) +
    theme(legend.position = "right") +
    scale_color_gradient(low="#E69F00", high="#009E73") +
    labs(title="Concours MCF, de 2013 à 2019", y ="Grandes disciplines CNU", x = "Nombre moyen de candidats par poste MCF (par section et par an)")
```

```{r candidats.par.poste.MCF.2, fig.width=12, fig.asp=9/16}
cnu %>%
  drop_na(candidats.par.poste.MCF) %>%
    ggplot(aes(x=candidats.par.poste.MCF, y=SousGroupeCNU, fill=GroupeCNU)) +
    geom_boxplot() +
    scale_x_continuous(breaks=seq(0,60,5)) +
    facet_grid(GrandeDisciplineCNU~., scales="free", space="free") +
    theme_cpesr_cap(authors=c("Florent Figon"), licence="CC BY-SA") +
    theme(strip.text.y = element_text(size = 7.5)) +
    theme(legend.position = "none") +
    labs(title="Concours MCF, de 2013 à 2019", y ="Grandes disciplines CNU", x = "Nombre moyen de candidats par poste MCF (par section et par an)")
```

## Nombre de candidatures par candidat aux postes MCF

### Vision globale par grande discipline et groupes CNU
```{r candidatures.par.candidat.MCF.1, fig.width=12, fig.asp=9/16}
cnu %>%
  drop_na(candidatures.par.candidat.MCF) %>%
    ggplot(aes(x=candidatures.par.candidat.MCF, y=GroupeCNU, color=Annee)) +
    geom_jitter(width = 0, height = 0.15) +
    scale_x_continuous(breaks=seq(0,30,2)) +
    facet_grid(GrandeDisciplineCNU~., scales="free", space="free") +
    theme_cpesr_cap(authors=c("Florent Figon"), licence="CC BY-SA") +
    theme(strip.text.y = element_text(size = 7.5)) +
    theme(legend.position = "right") +
    scale_color_gradient(low="#E69F00", high="#009E73") +
    labs(title="Concours MCF, de 2013 à 2019", y ="Grandes disciplines CNU", x = "Nombre moyen de candidatures aux concours MCF par candidat (par section et par an)")
```

```{r candidatures.par.candidat.MCF.2, fig.width=12, fig.asp=9/16}
cnu %>%
  drop_na(candidatures.par.candidat.MCF) %>%
    ggplot(aes(x=candidatures.par.candidat.MCF, y=GroupeCNU, fill=GroupeCNU)) +
    geom_boxplot() +
    scale_x_continuous(breaks=seq(0,30,2)) +
    facet_grid(GrandeDisciplineCNU~., scales="free", space="free") +
    theme_cpesr_cap(authors=c("Florent Figon"), licence="CC BY-SA") +
    theme(strip.text.y = element_text(size = 7.5)) +
    theme(legend.position = "none") +
    scale_color_gradient(low="#E69F00", high="#009E73") +
    labs(title="Concours MCF, de 2013 à 2019", y ="Grandes disciplines CNU", x = "Nombre moyen de candidatures aux concours MCF par candidat (par section et par an)")
```

**Remarques :**

* Le nb de candidatures par candidat est borné par le nombre de postes publiés. S'il n'y a qu'un poste (ex. en LLA 2015), il ne peut y avoir qu'une candidature par candidat.
* Ces calculs ne prennent pas en compte le fait que certains candidats candidatent dans plusieurs sections.
* C'est un nombre moyen de candidatures. Certains candidatent plus, d'autres moins, et on ne connait pas cette disparité avec ce jeu de données.

**Questions :**

Si des personnes ont des idées de comment intégrer cette variable du nb de postes dans le calcul et/ou l'analyse, nous sommes preneurs.

* Une possibilité serait de ne garder que les sections > 2 postes (ou tout autre chiffre plus pertinent).
* [\@Pandalatesta](https://twitter.com/Pandalatesta/status/1333473037342175233) : C'est possible d'avoir le nb de candidatures rapportés au nb de postes (en gros un candidat candidate à cb de % des postes publiés). Ca permettrait de voir si l'effet désespoir et plus fort que l'effet de spécialisation des profils qui permet de faire le tri.

Pour regarder le potentiel rôle du CNU comme filtre évitant le trop plein de candidatures dans certaines disciplines :

* [\@gaiauniversitas](https://twitter.com/gaiauniversitas/status/1333468971350200321) : C’est certain qu’avec ce genre de graphe on comprend mieux pourquoi les profs de droits sont contre la suppression de la qualification.
* [\@gaiauniversitas](https://twitter.com/gaiauniversitas/status/1333484701428969472) : si dans une discipline les candidats font de nombreuses candidatures, on peut être tenté par un taux de qualification faible afin de ne pas submerger les comités de sélection.
* [\@gaiauniversitas](https://twitter.com/gaiauniversitas/status/1333485369963270149) : graphique du nombre moyen de candidatures par candidats, en fonction du taux de qualifiés
* [\@snoevpr](https://twitter.com/Snoevpr/status/1333530523956862976) : données sur 15 ans pour les postes publiés, et mettre en regard le nombre de candidats chaque année et le nombre de qualifiés (par section). Je doute qu on observe une corrélation significative....
* [\@gaiauniversitas](https://twitter.com/gaiauniversitas/status/1333532431555702784) : le point initial était l’étude d’une éventuelle corrélation entre le nombre moyen de candidatures par candidats en fonction du taux de qualifiés (section par section, ou groupe par groupe). Là je pense qu’on a des chances de voir une corrélation et ça peut être éclairant.
* [\@snoevpr](https://twitter.com/Snoevpr/status/1333534262767857664) : Pas si clair que ça soit si bien corrélé : par exemple, suivant les pratiques de fléchage, ça peut donner des choses assez différentes. Et y a un nombre non négligeable de qualifiés qui ne candidatent pas. A voir.

**Visualisation :**

* [\@snoevpr](https://twitter.com/Snoevpr/status/1333487810280611843) : le meme avec des symboles différents par section dans un groupe ?
* [\@snoevpr](https://twitter.com/Snoevpr/status/1333511064248520707) : tracer séparément chaque groupe puis superposer en décalant et sans les axes sauf pour un ?

### Evolution de 2013 à 2019 toutes sections confondues
```{r candidatures.par.candidat.MCF.3}
cnu %>%
  drop_na(candidatures.par.candidat.MCF) %>%
    ggplot(aes(x=as.factor(Annee), y=candidatures.par.candidat.MCF)) +
    geom_boxplot() +
    theme_cpesr_cap(authors=c("Florent Figon"), 
      licence="CC BY-SA")
```

### Evolution de 2013 à 2019 par grande discipline
```{r candidatures.par.candidat.MCF.4}
cnu %>%
  drop_na(candidatures.par.candidat.MCF) %>%
    ggplot(aes(x=as.factor(Annee), y=candidatures.par.candidat.MCF)) +
    geom_boxplot() +
    facet_wrap(.~GrandeDisciplineCNU, scale="free") +
    theme_cpesr_cap(authors=c("Florent Figon"), 
      licence="CC BY-SA")
```



### Candidats, candidatures et postes

```{r candidats.candidatures.postes}
cnu %>%
  drop_na(candidatures.par.candidat.MCF) %>%
    ggplot(aes(x=PostesPublies.MCF, y=candidatures.par.candidat.MCF)) +
    geom_point(aes(color=Code.GrandeDisciplineCNU, alpha=Annee)) +
    scale_color_discrete(name="CNU") + 
    #facet_wrap(.~GrandeDisciplineCNU, scale="free") +
    theme_cpesr_cap(authors=c("Florent Figon", "Julien Gossa"), 
      licence="CC BY-SA") + theme(legend.position = "right")
```

```{r candidats.candidatures.postes.2, fig.width=12, fig.asp=9/16}
cnu %>%
  drop_na(candidatures.par.candidat.MCF) %>%
    ggplot(aes(x=PostesPublies.MCF, y=candidatures.par.candidat.MCF)) +
    geom_point(aes(color=SectionCNU
                   #, alpha=Annee
                   )) +
    #geom_text(data=filter(cnu, Annee==2019),
              #aes(color=SectionCNU, label=SectionCNU.ID)) +
    geom_label_repel(data=filter(cnu, Annee==2019),
                    aes(label = SectionCNU.ID, fill = factor(SectionCNU)), color = 'white',
                    size = 3.5) +
    scale_color_discrete(name="CNU") + 
    facet_wrap(.~GrandeDisciplineCNU, scale="free") +
    theme_cpesr_cap(authors=c("Florent Figon", "Julien Gossa"), 
      licence="CC BY-SA") + theme(legend.position = "none") #+ 
    #scale_colour_colorblind()
```

```{r candidats.candidatures.postes.DEG}
cnu %>%
  filter(Code.GrandeDisciplineCNU == "DEG") %>%
  drop_na(candidatures.par.candidat.MCF) %>%
    ggplot(aes(x=PostesPublies.MCF, y=candidatures.par.candidat.MCF)) +
    geom_point(aes(color=SectionCNU, alpha=Annee)) +
    geom_text(data=filter(cnu,Code.GrandeDisciplineCNU == "DEG", Annee==2019),
              aes(color=SectionCNU, label=SectionCNU)) +
    guides(color=FALSE) +
    #facet_wrap(.~GrandeDisciplineCNU, scale="free") +
    theme_cpesr_cap(authors=c("Florent Figon", "Julien Gossa"), 
      licence="CC BY-SA") + theme(legend.position = "right")
```

```{r candidats.candidatures.postes.DEG.2, fig.width=12, fig.asp=1/2}
cnu %>%
  filter(Code.GrandeDisciplineCNU == "DEG") %>%
  drop_na(candidatures.par.candidat.MCF) %>%
    ggplot(aes(x=PostesPublies.MCF, y=candidatures.par.candidat.MCF)) +
    geom_point(aes(color=SectionCNU)) +
    geom_smooth(aes(color=SectionCNU), method=lm, se=FALSE, size=0.5) +
    # geom_label_repel(data=filter(cnu, Annee==2019, Code.GrandeDisciplineCNU == "DEG"),
    #                 aes(label = SectionCNU.ID, fill = factor(SectionCNU)), color = 'white',
    #                 size = 3.5) +
    guides(color=FALSE) +
    facet_wrap(SectionCNU.ID~., scale="free_x") +
    theme_cpesr_cap(authors=c("Florent Figon", "Julien Gossa"), 
      licence="CC BY-SA") + theme(legend.position = "none") +
    stat_poly_eq(geom = "text_npc", formula = my.formula, 
                aes(label = paste(..rr.label.., ..p.value.label.., sep ="~~~"), 
                    color=SectionCNU), parse = TRUE, size=3.5,
                label.y=1, 
                label.x=0
                )
```

```{r candidats.candidatures.postes.LSHS, fig.width=12, fig.asp=1}
cnu %>%
  filter(Code.GrandeDisciplineCNU == "LSHS") %>%
  drop_na(candidatures.par.candidat.MCF) %>%
    ggplot(aes(x=PostesPublies.MCF, y=candidatures.par.candidat.MCF)) +
    geom_point(aes(color=SectionCNU)) +
    geom_smooth(aes(color=SectionCNU), method=lm, se=FALSE, size=0.5) +
    # geom_label_repel(data=filter(cnu, Annee==2019, Code.GrandeDisciplineCNU == "LSHS"),
    #                 aes(label = SectionCNU.ID, fill = factor(SectionCNU)), color = 'white',
    #                 size = 3.5) +
    guides(color=FALSE) +
    facet_wrap(SectionCNU.ID~., scale="free_x") +
    theme_cpesr_cap(authors=c("Florent Figon", "Julien Gossa"), 
      licence="CC BY-SA") + theme(legend.position = "none") +
    stat_poly_eq(geom = "text_npc", formula = my.formula, 
                aes(label = paste(..rr.label.., ..p.value.label.., sep ="~~~"), 
                    color=SectionCNU), parse = TRUE, size=3.5,
                label.y=1, 
                label.x=0
                )
```

```{r candidats.candidatures.postes.Pharma, fig.width=12, fig.asp=1/4}
cnu %>%
  filter(Code.GrandeDisciplineCNU == "Pharma") %>%
  drop_na(candidatures.par.candidat.MCF) %>%
    ggplot(aes(x=PostesPublies.MCF, y=candidatures.par.candidat.MCF)) +
    geom_point(aes(color=SectionCNU)) +
    geom_smooth(aes(color=SectionCNU), method=lm, se=FALSE, size=0.5) +
    # geom_label_repel(data=filter(cnu, Annee==2019, Code.GrandeDisciplineCNU == "Pharma"),
    #                 aes(label = SectionCNU.ID, fill = factor(SectionCNU)), color = 'white',
    #                 size = 3.5) +
    guides(color=FALSE) +
    facet_wrap(SectionCNU.ID~., scale="free_x") +
    theme_cpesr_cap(authors=c("Florent Figon", "Julien Gossa"), 
      licence="CC BY-SA") + theme(legend.position = "none") +
    stat_poly_eq(geom = "text_npc", formula = my.formula, 
                aes(label = paste(..rr.label.., ..p.value.label.., sep ="~~~"), 
                    color=SectionCNU), parse = TRUE, size=3.5,
                label.y=1, 
                label.x=0
                )
```

```{r candidats.candidatures.postes.ST, fig.width=12, fig.asp=1}
cnu %>%
  filter(Code.GrandeDisciplineCNU == "ST") %>%
  drop_na(candidatures.par.candidat.MCF) %>%
    ggplot(aes(x=PostesPublies.MCF, y=candidatures.par.candidat.MCF)) +
    geom_point(aes(color=SectionCNU)) +
    geom_smooth(aes(color=SectionCNU), method=lm, se=FALSE, size=0.5) +
    # geom_label_repel(data=filter(cnu, Annee==2019, Code.GrandeDisciplineCNU == "ST"),
    #                 aes(label = SectionCNU.ID, fill = factor(SectionCNU)), color = 'white',
    #                 size = 3.5) +
    guides(color=FALSE) +
    facet_wrap(SectionCNU.ID~., scale="free_x") +
    theme_cpesr_cap(authors=c("Florent Figon", "Julien Gossa"), 
      licence="CC BY-SA") + theme(legend.position = "none") +
    stat_poly_eq(geom = "text_npc", formula = my.formula, 
                 aes(label = paste(..rr.label.., ..p.value.label.., sep ="~~~"), 
                     color=SectionCNU), parse = TRUE, size=3.5,
                 label.y=1, 
                 label.x=0
                 )
```

```{r candidatures.par.poste, fig.width=12, fig.asp=9/16}
cnu %>%
  drop_na(candidatures.par.poste.MCF) %>%
    ggplot(aes(x=candidatures.par.poste.MCF, y=GroupeCNU, fill=GroupeCNU)) +
    geom_boxplot() +
    #scale_x_continuous(breaks=seq(0,30,2)) +
    facet_grid(GrandeDisciplineCNU~., scales="free", space="free") +
    theme_cpesr_cap(authors=c("Florent Figon", "Julien Gossa"), licence="CC BY-SA") +
    theme(strip.text.y = element_text(size = 7.5)) +
    theme(legend.position = "none") +
    scale_color_gradient(low="#E69F00", high="#009E73") +
    labs(title="Concours MCF, de 2013 à 2019", 
         y ="Grandes disciplines CNU", 
         x = "Nombre de candidatures par poste aux concours MCF (par section et par an)")
```

```{r candidatures.par.poste.2, fig.width=12, fig.asp=9/16}
cnu %>%
  drop_na(candidatures.par.poste.MCF) %>%
    ggplot(aes(x=candidatures.par.poste.MCF, y=GroupeCNU, color=Annee)) +
    geom_jitter(width = 0, height = 0.15) +
    facet_grid(GrandeDisciplineCNU~., scales="free", space="free") +
    theme_cpesr_cap(authors=c("Florent Figon", "Julien Gossa"), licence="CC BY-SA") +
    theme(strip.text.y = element_text(size = 7.5)) +
    scale_color_gradient(low="#E69F00", high="#009E73") +
    labs(title="Concours MCF, de 2013 à 2019", 
         y ="Grandes disciplines CNU", 
         x = "Nombre de candidatures par poste aux concours MCF (par section et par an)")
```

```{r candidatures.par.candidat.par.poste, fig.width=12, fig.asp=9/16}
cnu %>%
  drop_na(candidatures.par.poste.MCF) %>%
    ggplot(aes(x=candidatures.par.candidat.par.poste.MCF, y=SousGroupeCNU, fill=GroupeCNU)) +
    geom_boxplot() +
    facet_grid(GrandeDisciplineCNU~., scales="free", space="free") +
    theme_cpesr_cap(authors=c("Florent Figon", "Julien Gossa"), licence="CC BY-SA") +
    theme(strip.text.y = element_text(size = 7.5)) +
    theme(legend.position = "none") +
    scale_x_continuous(labels=scales::percent, breaks = seq(0,1,0.1)) +
    labs(title="Concours MCF, de 2013 à 2019", 
         y ="Sous-groupes CNU", 
         x = "Pourcentage de postes auxquels un·e candidat·e postule (par section et par an)")
```

```{r candidatures.par.candidat.par.poste.2, fig.width=12, fig.asp=9/16}
cnu %>%
  drop_na(candidatures.par.poste.MCF) %>%
    ggplot(aes(x=candidatures.par.candidat.par.poste.MCF, y=SousGroupeCNU, color=GroupeCNU)) +
    geom_jitter(width = 0, height = 0.15) +
    facet_grid(GrandeDisciplineCNU~., scales="free", space="free") +
    theme_cpesr_cap(authors=c("Florent Figon", "Julien Gossa"), licence="CC BY-SA") +
    theme(strip.text.y = element_text(size = 7.5)) +
    theme(legend.position = "none") +
    scale_x_continuous(labels=scales::percent, breaks = seq(0,1,0.1)) +
    labs(title="Concours MCF, de 2013 à 2019", 
         y ="Sous-groupes CNU", 
         x = "Pourcentage de postes auxquels un·e candidat·e postule (par section et par an)")
```

## Comparaison nb de postes, candidats et qualifiés par section
### En 2019
Ordonné par nb de postes publiés
```{r qualifies.candidats.postes.2019.1, fig.width=12, fig.asp=9/16}
cnu %>%
  filter(Annee == 2019) %>%
  drop_na(PostesPublies.MCF) %>%
  ggplot(aes(x = as.factor(fct_rev(reorder(SectionCNU.ID, PostesPublies.MCF))))) +
    geom_col(aes(y = Candidats.MCF), fill = "grey") +
    geom_col(aes(y = PostesPublies.MCF, fill = GrandeDisciplineCNU)) +
    geom_point(aes(y = QualificationQualifies.MCF), color = "black") +
    geom_text(aes(y = PostesPublies.MCF, label=PostesPublies.MCF), 
              vjust=-0, color="white", 
              position = position_dodge(0.9), size=3.5) +
    # geom_text(aes(y = QualificationQualifies.MCF, label=QualificationQualifies.MCF), 
    #           vjust=-0.5, color="black", 
    #           position = position_dodge(0.9), size=2) +
    geom_text(aes(y = Candidats.MCF, label=Candidats.MCF), 
              vjust=-0, color="black", 
              position = position_dodge(0.9), size=3) +
    # coord_flip() +
    scale_y_continuous(limits = c(0, 650), expand = c(0,0)) +
    ggtitle("Campagne MCF de 2019") +
    xlab("Sections CNU (par nombre de postes décroissant)") + 
    ylab("Nombre de postes, de candidats (barres) et de qualifiés (points)") +
    labs(fill = "Grandes disciplines CNU") +
    theme_cpesr_cap(authors = c("Florent Figon"), 
                licence = "CC BY-SA",
                url = "https://github.com/cpesr/RFC",
                source = "DGRH A1-1/Galaxie")
```

Ordonné par nb de candidats / nb de postes
```{r qualifies.candidats.postes.2019.2, fig.width=12, fig.asp=9/16}
cnu %>%
  filter(Annee == 2019) %>%
  drop_na(PostesPublies.MCF) %>%
  ggplot(aes(x = as.factor(fct_rev(reorder(SectionCNU.ID, candidats.par.poste.MCF))))) +
    geom_col(aes(y = Candidats.MCF), fill = "grey") +
    geom_col(aes(y = PostesPublies.MCF, fill = GrandeDisciplineCNU)) +
    geom_point(aes(y = QualificationQualifies.MCF), color = "black") +
    geom_text(aes(y = PostesPublies.MCF, label=PostesPublies.MCF), 
              vjust=-0, color="white", 
              position = position_dodge(0.9), size=3.5) +
    # geom_text(aes(y = QualificationQualifies.MCF, label=QualificationQualifies.MCF), 
    #           vjust=-0.5, color="black", 
    #           position = position_dodge(0.9), size=2) +
    geom_text(aes(y = Candidats.MCF, label=Candidats.MCF), 
              vjust=-0, color="black", 
              position = position_dodge(0.9), size=3) +
    # coord_flip() +
    scale_y_continuous(limits = c(0, 650), expand = c(0,0)) +
    ggtitle("Campagne MCF de 2019") +
    xlab("Sections CNU (par ratio [nb de candidats / nb de postes] décroissant)") + 
    ylab("Nombre de postes, de candidats (barres) et de qualifiés (points)") +
    labs(fill = "Grandes disciplines CNU") +
    theme_cpesr_cap(authors = c("Florent Figon"), 
                licence = "CC BY-SA",
                url = "https://github.com/cpesr/RFC",
                source = "DGRH A1-1/Galaxie")
```

Ordonné par section
```{r qualifies.candidats.postes.2019.3, fig.width=12, fig.asp=9/16}
cnu %>%
  filter(Annee == 2019) %>%
  drop_na(PostesPublies.MCF) %>%
  ggplot(aes(x = as.factor(SectionCNU.ID))) +
    geom_col(aes(y = Candidats.MCF), fill = "grey") +
    geom_col(aes(y = PostesPublies.MCF, fill = GrandeDisciplineCNU)) +
    geom_point(aes(y = QualificationQualifies.MCF), color = "black") +
    geom_text(aes(y = PostesPublies.MCF, label=PostesPublies.MCF), 
              vjust=-0, color="white", 
              position = position_dodge(0.9), size=3.5) +
    # geom_text(aes(y = QualificationQualifies.MCF, label=QualificationQualifies.MCF), 
    #           vjust=-0.5, color="black", 
    #           position = position_dodge(0.9), size=2) +
    geom_text(aes(y = Candidats.MCF, label=Candidats.MCF), 
              vjust=-0, color="black", 
              position = position_dodge(0.9), size=3) +
    # coord_flip() +
    scale_y_continuous(limits = c(0, 650), expand = c(0,0)) +
    ggtitle("Campagne MCF de 2019") +
    xlab("Sections CNU") + 
    ylab("Nombre de postes, de candidats (barres) et de qualifiés (points)") +
    labs(fill = "Grandes disciplines CNU") +
    theme_cpesr_cap(authors = c("Florent Figon"), 
                licence = "CC BY-SA",
                url = "https://github.com/cpesr/RFC",
                source = "DGRH A1-1/Galaxie")
```

### En 2013
```{r qualifies.candidats.postes.2013.1, fig.width=12, fig.asp=9/16}
cnu %>%
  filter(Annee == 2013) %>%
  drop_na(PostesPublies.MCF) %>%
  ggplot(aes(x = as.factor(fct_rev(reorder(SectionCNU.ID, PostesPublies.MCF))))) +
    geom_col(aes(y = Candidats.MCF), fill = "grey") +
    geom_col(aes(y = PostesPublies.MCF, fill = GrandeDisciplineCNU)) +
    geom_point(aes(y = QualificationQualifies.MCF), color = "black") +
    geom_text(aes(y = PostesPublies.MCF, label=PostesPublies.MCF), 
              vjust=-0, color="white", 
              position = position_dodge(0.9), size=3.5) +
    # geom_text(aes(y = QualificationQualifies.MCF, label=QualificationQualifies.MCF), 
    #           vjust=-0.5, color="black", 
    #           position = position_dodge(0.9), size=2) +
    geom_text(aes(y = Candidats.MCF, label=Candidats.MCF), 
              vjust=-0, color="black", 
              position = position_dodge(0.9), size=3) +
    # coord_flip() +
    scale_y_continuous(limits = c(0, 700), expand = c(0,0)) +
    ggtitle("Campagne MCF de 2013") +
    xlab("Sections CNU (par nombre de postes décroissant)") + 
    ylab("Nombre de postes, de candidats (barres) et de qualifiés (points)") +
    labs(fill = "Grandes disciplines CNU") +
    theme_cpesr_cap(authors = c("Florent Figon"), 
                licence = "CC BY-SA",
                url = "https://github.com/cpesr/RFC",
                source = "DGRH A1-1/Galaxie")
```

Ordonné par nb de candidats / nb de postes
```{r qualifies.candidats.postes.2013.2, fig.width=12, fig.asp=9/16}
cnu %>%
  filter(Annee == 2013) %>%
  drop_na(PostesPublies.MCF) %>%
  ggplot(aes(x = as.factor(fct_rev(reorder(SectionCNU.ID, candidats.par.poste.MCF))))) +
    geom_col(aes(y = Candidats.MCF), fill = "grey") +
    geom_col(aes(y = PostesPublies.MCF, fill = GrandeDisciplineCNU)) +
    geom_point(aes(y = QualificationQualifies.MCF), color = "black") +
    geom_text(aes(y = PostesPublies.MCF, label=PostesPublies.MCF), 
              vjust=-0, color="white", 
              position = position_dodge(0.9), size=3.5) +
    # geom_text(aes(y = QualificationQualifies.MCF, label=QualificationQualifies.MCF), 
    #           vjust=-0.5, color="black", 
    #           position = position_dodge(0.9), size=2) +
    geom_text(aes(y = Candidats.MCF, label=Candidats.MCF), 
              vjust=-0, color="black", 
              position = position_dodge(0.9), size=3) +
    # coord_flip() +
    scale_y_continuous(limits = c(0, 700), expand = c(0,0)) +
    ggtitle("Campagne MCF de 2013") +
    xlab("Sections CNU (par ratio [nb de candidats / nb de postes] décroissant)") + 
    ylab("Nombre de postes, de candidats (barres) et de qualifiés (points)") +
    labs(fill = "Grandes disciplines CNU") +
    theme_cpesr_cap(authors = c("Florent Figon"), 
                licence = "CC BY-SA",
                url = "https://github.com/cpesr/RFC",
                source = "DGRH A1-1/Galaxie")
```

Ordonné par section
```{r qualifies.candidats.postes.2013.3, fig.width=12, fig.asp=9/16}
cnu %>%
  filter(Annee == 2013) %>%
  drop_na(PostesPublies.MCF) %>%
  ggplot(aes(x = as.factor(SectionCNU.ID))) +
    geom_col(aes(y = Candidats.MCF), fill = "grey") +
    geom_col(aes(y = PostesPublies.MCF, fill = GrandeDisciplineCNU)) +
    geom_point(aes(y = QualificationQualifies.MCF), color = "black") +
    geom_text(aes(y = PostesPublies.MCF, label=PostesPublies.MCF), 
              vjust=-0, color="white", 
              position = position_dodge(0.9), size=3.5) +
    # geom_text(aes(y = QualificationQualifies.MCF, label=QualificationQualifies.MCF), 
    #           vjust=-0.5, color="black", 
    #           position = position_dodge(0.9), size=2) +
    geom_text(aes(y = Candidats.MCF, label=Candidats.MCF), 
              vjust=-0, color="black", 
              position = position_dodge(0.9), size=3) +
    # coord_flip() +
    scale_y_continuous(limits = c(0, 700), expand = c(0,0)) +
    ggtitle("Campagne MCF de 2013") +
    xlab("Sections CNU") + 
    ylab("Nombre de postes, de candidats (barres) et de qualifiés (points)") +
    labs(fill = "Grandes disciplines CNU") +
    theme_cpesr_cap(authors = c("Florent Figon"), 
                licence = "CC BY-SA",
                url = "https://github.com/cpesr/RFC",
                source = "DGRH A1-1/Galaxie")
```

### Evolution de 2014 à 2019
```{r evolution.qualifies.candidats.postes.2014to2019.1, fig.width=12, fig.asp=9/16}
cnu.2014to2019 <- cnu %>% 
  filter(Annee > 2013) %>%
  group_by(SectionCNU.ID) %>% 
  arrange(Annee, SectionCNU.ID) %>% 
  mutate(debut.postes = first(PostesPublies.MCF),
         debut.qualifies = first(QualificationQualifies.MCF),
         debut.candidats = first(Candidats.MCF)) %>%
  mutate(evolution.postes = 100*(PostesPublies.MCF - debut.postes)/debut.postes,
         evolution.qualifies = 100*(QualificationQualifies.MCF - debut.qualifies)/debut.qualifies,
        evolution.candidats= 100*(Candidats.MCF - debut.candidats)/debut.candidats) %>%
  ungroup()

cnu.2014to2019 %>%
  filter(Annee == 2019) %>%
  drop_na(evolution.postes) %>%
  ggplot(aes(x = as.factor(fct_rev(reorder(SectionCNU.ID, evolution.postes))))) +
    geom_col(aes(y = evolution.candidats), fill = "grey") +
    geom_col(aes(y = evolution.postes, fill = GrandeDisciplineCNU), alpha = 0.5) +
    # geom_point(aes(y = evolution.qualifies), color = "black") +
    # geom_text(aes(y = evolution.postes, label=evolution.postes), 
    #           vjust=-0, color="white", 
    #           position = position_dodge(0.9), size=3.5) +
    # geom_text(aes(y = evolution.qualifies, label=evolution.qualifies), 
    #           vjust=-0.5, color="black", 
    #           position = position_dodge(0.9), size=2) +
    # geom_text(aes(y = evolution.candidats, label=evolution.candidats), 
    #           vjust=-0, color="black", 
    #           position = position_dodge(0.9), size=3) +
      geom_text(aes(y = evolution.postes, label=PostesPublies.MCF - debut.postes),
                vjust=-0, color="black",
                position = position_dodge(0.9), size=3.5) +
    # coord_flip() +
    scale_y_continuous(limits = c(-100, 220), expand = c(0,0)) +
    ggtitle("Campagne MCF de 2019 par rapport à 2014") +
    xlab("Sections CNU (par évolution du nb de postes décroissante)") + 
    ylab("Evolutions du nombre de postes (couleurs) et de candidats (gris) en %") +
    labs(fill = "Grandes disciplines CNU") +
    theme_cpesr_cap(authors = c("Florent Figon"), 
                licence = "CC BY-SA",
                url = "https://github.com/cpesr/RFC",
                source = "DGRH A1-1/Galaxie")
```

Ordonné par section
```{r evolution.qualifies.candidats.postes.2014to2019.2, fig.width=12, fig.asp=9/16}
cnu.2014to2019 %>%
  filter(Annee == 2019) %>%
  drop_na(evolution.postes) %>%
  ggplot(aes(x = as.factor(SectionCNU.ID))) +
    geom_col(aes(y = evolution.candidats), fill = "grey") +
    geom_col(aes(y = evolution.postes, fill = GrandeDisciplineCNU), alpha = 0.5) +
    # geom_point(aes(y = evolution.qualifies), color = "black") +
    # geom_text(aes(y = evolution.postes, label=evolution.postes), 
    #           vjust=-0, color="white", 
    #           position = position_dodge(0.9), size=3.5) +
    # geom_text(aes(y = evolution.qualifies, label=evolution.qualifies), 
    #           vjust=-0.5, color="black", 
    #           position = position_dodge(0.9), size=2) +
    # geom_text(aes(y = evolution.candidats, label=evolution.candidats), 
    #           vjust=-0, color="black", 
    #           position = position_dodge(0.9), size=3) +
      geom_text(aes(y = evolution.postes, label=PostesPublies.MCF - debut.postes),
                vjust=-0, color="black",
                position = position_dodge(0.9), size=3.5) +
    # coord_flip() +
    scale_y_continuous(limits = c(-100, 220), expand = c(0,0)) +
    facet_wrap(SousGroupeCNU~., scales="free") +
    ggtitle("Campagne MCF de 2019 par rapport à 2014") +
    xlab("Sections CNU") + 
    ylab("Evolutions du nombre de postes (couleurs) et de candidats (gris) en %") +
    labs(fill = "Grandes disciplines CNU") +
    theme_cpesr_cap(authors = c("Florent Figon"), 
                licence = "CC BY-SA",
                url = "https://github.com/cpesr/RFC",
                source = "DGRH A1-1/Galaxie")
```